#! /usr/bin/env bash

# autogenerated by linuxdeploy
# modified for privesc

# make sure errors in sourced scripts will cause this script to stop
set -e

this_dir="$(readlink -f "$(dirname "$0")")"

source "$this_dir"/apprun-hooks/"linuxdeploy-plugin-gtk.sh"


if [ $UID -ne 0 ]; then
	bin=AppRun.wrapped
	mountpoint=${APPDIR}-elevated
	# Extract and run appimage in a separate dir to work around not being able to run binaries with suid in fuse mounts
	cmd="mkdir $mountpoint && cd $mountpoint && $APPIMAGE --appimage-extract > /dev/null && $mountpoint/squashfs-root/$bin && sleep 1 && rm -r $mountpoint"
	pkexec env DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY APPIMAGE=$APPIMAGE APPDIR=$APPDIR sh -c "$cmd"
else
  exec "$this_dir"/AppRun.wrapped "$@"
fi
